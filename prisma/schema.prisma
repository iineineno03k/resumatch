generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model applicants {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  company_id String    @db.Uuid
  job_id     String    @db.Uuid
  name       String    @db.VarChar(255)
  email      String?   @db.VarChar(255)
  phone      String?   @db.VarChar(50)
  status     String    @default("screening") @db.VarChar(50)
  applied_at DateTime? @default(now()) @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  companies  companies @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  jobs       jobs      @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  notes      notes[]
  resumes    resumes?

  @@index([company_id], map: "idx_applicants_company_id")
  @@index([job_id], map: "idx_applicants_job_id")
  @@index([status], map: "idx_applicants_status")
}

model companies {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String                @db.VarChar(255)
  slug                String                @unique @db.VarChar(100)
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?             @default(now()) @db.Timestamptz(6)
  applicants          applicants[]
  company_invitations company_invitations[]
  jobs                jobs[]
  users               users[]

  @@index([slug], map: "idx_companies_slug")
}

model company_invitations {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  company_id         String    @db.Uuid
  invited_by_user_id String    @db.Uuid
  token              String    @unique @db.VarChar(255)
  role               String    @default("member") @db.VarChar(50)
  expires_at         DateTime  @db.Timestamptz(6)
  used_at            DateTime? @db.Timestamptz(6)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  companies          companies @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users              users     @relation(fields: [invited_by_user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([company_id], map: "idx_company_invitations_company_id")
  @@index([token], map: "idx_company_invitations_token")
}

model jobs {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  company_id   String       @db.Uuid
  title        String       @db.VarChar(255)
  description  String?
  requirements String?
  status       String       @default("open") @db.VarChar(50)
  created_at   DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at   DateTime?    @default(now()) @db.Timestamptz(6)
  applicants   applicants[]
  companies    companies    @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([company_id], map: "idx_jobs_company_id")
  @@index([status], map: "idx_jobs_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model notes {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  applicant_id String     @db.Uuid
  user_id      String     @db.Uuid
  content      String
  rating       Int?
  created_at   DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime?  @default(now()) @db.Timestamptz(6)
  applicants   applicants @relation(fields: [applicant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users        users      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([applicant_id], map: "idx_notes_applicant_id")
  @@index([user_id], map: "idx_notes_user_id")
}

model resumes {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  applicant_id    String     @unique @db.Uuid
  file_url        String
  file_name       String?    @db.VarChar(255)
  extracted_text  String?
  ai_analysis     Json?
  analysis_status String     @default("pending") @db.VarChar(50)
  analyzed_at     DateTime?  @db.Timestamptz(6)
  created_at      DateTime?  @default(now()) @db.Timestamptz(6)
  applicants      applicants @relation(fields: [applicant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([analysis_status], map: "idx_resumes_analysis_status")
  @@index([applicant_id], map: "idx_resumes_applicant_id")
}

model users {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clerk_user_id       String                @unique @db.VarChar(255)
  email               String                @db.VarChar(255)
  name                String?               @db.VarChar(255)
  avatar_url          String?
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?             @default(now()) @db.Timestamptz(6)
  company_id          String?               @db.Uuid
  role                String?               @default("member") @db.VarChar(50)
  company_invitations company_invitations[]
  notes               notes[]
  companies           companies?            @relation(fields: [company_id], references: [id], onUpdate: NoAction)

  @@index([clerk_user_id], map: "idx_users_clerk_user_id")
  @@index([company_id], map: "idx_users_company_id")
}
