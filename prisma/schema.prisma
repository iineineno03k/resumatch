generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model applicants {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  team_id    String    @db.Uuid
  job_id     String    @db.Uuid
  name       String    @db.VarChar(255)
  email      String?   @db.VarChar(255)
  phone      String?   @db.VarChar(50)
  status     String    @default("screening") @db.VarChar(50)
  applied_at DateTime? @default(now()) @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  jobs       jobs      @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  teams      teams     @relation(fields: [team_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  notes      notes[]
  resumes    resumes?

  @@index([job_id], map: "idx_applicants_job_id")
  @@index([status], map: "idx_applicants_status")
  @@index([team_id], map: "idx_applicants_team_id")
}

model jobs {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  team_id      String       @db.Uuid
  title        String       @db.VarChar(255)
  description  String?
  requirements String?
  status       String       @default("open") @db.VarChar(50)
  created_at   DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at   DateTime?    @default(now()) @db.Timestamptz(6)
  applicants   applicants[]
  teams        teams        @relation(fields: [team_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([status], map: "idx_jobs_status")
  @@index([team_id], map: "idx_jobs_team_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model notes {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  applicant_id String     @db.Uuid
  user_id      String     @db.Uuid
  content      String
  rating       Int?
  created_at   DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime?  @default(now()) @db.Timestamptz(6)
  applicants   applicants @relation(fields: [applicant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users        users      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([applicant_id], map: "idx_notes_applicant_id")
  @@index([user_id], map: "idx_notes_user_id")
}

model resumes {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  applicant_id    String     @unique @db.Uuid
  file_url        String
  file_name       String?    @db.VarChar(255)
  extracted_text  String?
  ai_analysis     Json?
  analysis_status String     @default("pending") @db.VarChar(50)
  analyzed_at     DateTime?  @db.Timestamptz(6)
  created_at      DateTime?  @default(now()) @db.Timestamptz(6)
  applicants      applicants @relation(fields: [applicant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([analysis_status], map: "idx_resumes_analysis_status")
  @@index([applicant_id], map: "idx_resumes_applicant_id")
}

model team_invitations {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  team_id            String    @db.Uuid
  invited_by_user_id String    @db.Uuid
  token              String    @unique @db.VarChar(255)
  role               String    @default("member") @db.VarChar(50)
  expires_at         DateTime  @db.Timestamptz(6)
  used_at            DateTime? @db.Timestamptz(6)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  users              users     @relation(fields: [invited_by_user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  teams              teams     @relation(fields: [team_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([team_id], map: "idx_team_invitations_team_id")
  @@index([token], map: "idx_team_invitations_token")
}

model team_members {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  team_id    String    @db.Uuid
  user_id    String    @db.Uuid
  role       String    @default("member") @db.VarChar(50)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  teams      teams     @relation(fields: [team_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([team_id, user_id])
  @@index([team_id], map: "idx_team_members_team_id")
  @@index([user_id], map: "idx_team_members_user_id")
}

model teams {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String             @db.VarChar(255)
  slug             String             @unique @db.VarChar(100)
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  applicants       applicants[]
  jobs             jobs[]
  team_invitations team_invitations[]
  team_members     team_members[]

  @@index([slug], map: "idx_teams_slug")
}

model users {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clerk_user_id    String             @unique @db.VarChar(255)
  email            String             @db.VarChar(255)
  name             String?            @db.VarChar(255)
  avatar_url       String?
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  notes            notes[]
  team_invitations team_invitations[]
  team_members     team_members[]

  @@index([clerk_user_id], map: "idx_users_clerk_user_id")
}
